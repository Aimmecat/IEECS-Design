# IEECS-Car 硬件设计总结与指南



## 1、概述

​	本项目旨在完成一套能适配MIT6.01课程——Iintroduction to EECS的硬件车。		

​	硬件设计部分包括整车的PCB硬件电路与外壳设计。

​	相较于Intel生产的Pioneer-3，新设计的车应当尽可能减小体积，删除在实验中应用不到的部分以降低整体成本。

​	该指南旨在讲解硬件设计中需要注意的点以及应用到的电路原理与相应的外设设计，为日后改进奠基。

​	依据本指南设计的IEECS-Car可满足最基本的硬件实验要求。

​	本硬件指南力求内容详实完整。



## 2、设计目标

  		1.	EECS硬件车主体与Head部分的电路设计
  		2.	完成整车与Head的外壳工业设计
  		3.	区别于原始车，新车采用无线串口连接方式
  		4.	新车具备体积小巧的特点
  		5.	车上需要搭载8个测距传感器
  		6.	车需要搭载辅助定位的传感器
  		7.	车需要搭载驱动轮子运动的电机
  		8.	车需要具备4个ADC输入口以及一个DAC输出口
  		9.	车需要具备输出10V,5V,GND的稳压源
  		10.	车需要具有显示电池电压的能力
  		11.	新车延续Intel车模结构，采用双驱动轮+单万向轮的三轮车结构



## 3、需要考虑的问题

	1.	选用的测距传感器，如何获取测距传感器的值并转化为相应的距离
	1.	选用无线串口如何避免同时存在多组串口时串扰问题
	1.	使用多大的电池作为电源，总共需要哪些电压
	1.	采用的稳压电路
	1.	采用的电机驱动电路
	1.	选用什么芯片作为主控
	1.	在ADC输入时，需要考虑单片机输入引脚的最大电压(一般为3.6V左右)，需要设计相应的分压电路
	1.	Head的传动结构



## 4、设计结构

### 	电路设计：

			1.	主控芯片最小系统
			1.	双电机驱动电路
			1.	8路测距ADC输入结构，4路外部ADC输入(0~10V)
			1.	1路DAC输出
			1.	10V, 5V，3.3V稳压电路
			1.	辅助Debug的显示屏，按键电路
			1.	无线串口电路设计
			1.	蜂鸣器电路设计
			1.	指示电源的指示灯设计

### 	工业设计：

 1. 车模与Head外壳设计

 2. 2组带编码器的电机、车轮和一组万向轮

 3. 指示电池电压的万用表

 4. 2s航模锂电池

 5. 一组无线串口(收与发)

 6. 8组红外测距传感器

 7.  金属一字螺丝刀头(用于Head传动)

 8. 线材，螺丝与尼龙柱

    

## 5、电路设计细节

​	本章节介绍电路设计细节。

​	整车(包括Head)共用3块PCB，其中搭载在车内部2块，一块为主控电路板，一块为电源板。另一块搭载在Head内部。

​	为了使整车的开关能更方便的固定在车壁上，又避免单独给开关焊接线材到主控上造成不美观，采用了电源开关与主控电路板分离的设计。

​	选用2s航模锂电池作为电源，满电电压为8.4V，理论上当电压低于8V时应及时充电，当长时间未使用电压低于7.2V时，可以判断为电池已过放。电池过放，或鼓包情况下严禁再次使用或尝试充电。

​	在电源板上，接入2s航模锂电池，通过开关控制输出给主控板电池电压，实现主控板电源的开关。板载10V，5.5V，3.3V稳压电源，并向外部输出10V与5V稳压电源。提供双6pin转接口，一边的6pin转接口包含4路ADC输入和2路由PWM控制的模拟DAC电压输出，另一边的6pin接口包含接到主板的4路ADC输入与从主板发出的2路PWM的占空比与方向控制信号。此处与原始设计有所出入，原始设计中需要提供1路DAC输出(在电路实验中，追光走实验中应用控制Head电机转动)，考虑到安全性，此处与控制车模电机采用相同的设计，利用主控输出控制信号并由电机驱动电路输出两路电机正负极信号控制Head电机转动(原设计为电机一侧接5V稳压，一侧接0~10V DAC输出)。

​	在主控电路板上，搭载了南京沁恒公司研发的CH32V307VCT6作为主控，通过电源板上开关控制的电源输入启动，电源负责给电机驱动电路完成供电，并实现5V与3.3V的稳压。其中CH32V307VCT6，驱动芯片DRV8701E，隔离芯片SN74HC125PWR，按键，蜂鸣器，屏幕利用到了3.3V电源，无线串口，ADC输入电路，电机编码器供电应用到了5V电源。两路电机驱动采用了基于DRV8701E的H桥电路，使用隔离芯片避免电流倒灌烧毁芯片。配备3个独立按键与1个屏幕辅助调试。一路蜂鸣器用于提示与上位机的连接，一路无线串口与上位机进行连接，8路ADC测距传感器输入，4路ADC外部输入，2路Head电机控制信号输出。

​	在Head电路上，主要完成对光敏电阻，激光灯，电机正负极，滑动变阻器的转接。

​	下面详细介绍每一部分采用的电路结构及注意事项。主要分析主控电路及电源电路，Head设计电路较为简单，讲解Head设计时顺带讲解。

------



#### 稳压电路设计



图一所示电路为电源板上2s航模锂电池的接入电路，电池接口选用XT30，此电路为减小开关打火损耗而设计，需要注意D2-BZT52C16为稳压二极管，二极管一般有线一侧为负极，在焊接时切忌焊反，一旦焊反，容易造成二极管击穿冒烟。

![电源输入](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\电源输入.png)

​																						图一

------



图二为经典利用MC34063完成的升压电路，设计参考MC34063数据手册https://atta.szlcsc.com/upload/public/pdf/source/20140614/1457707090981.pdf.

其输出电压可按照以下公式计算(以图中标号为例)
$$
V_{out}=\frac{VR1}{R5} \cdot V_{ref}
$$
其中$V_{ref}$的典型值为1.25V,由于电阻值并非绝对精确，可采用滑动变阻器灵活调节，调节完毕再使用胶水封住。若想要其他电压输出，改变其比例即可。C1,C8为有极性的钽电容，钽电容一般有线的一侧为正极，切忌焊接前要分清极性，焊反会导致电容自燃与爆炸。L1为电感，若电感质量差，焊接不牢固，可能造成电路上电后有噪音。如果用手焊接，建议用插件式电感。若整体PCB使用焊台焊接或由SMT焊接，则改用贴片。

![7.4V转10V](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\7.4V转10V.png)

​																						图二



------

图三为电源转5V电路，LM2940S-5芯片小巧，价格便宜，输出电流可观，外部电路进行简单的滤波即可满足一般使用，可参考LM2940S-5数据手册：https://atta.szlcsc.com/upload/public/pdf/source/20200113/C481672_D5DB35B2CB9893CB5D56608F126E1817.pdf

![7.4V转5V](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\7.4V转5V.png)

​																						图三



------

图4为5V转3.3V电路，之所以不使用电源直降3.3V，是为了减小功率的损耗与发热量。采用经典的AMS1117-3.3电路，同样对输入输出电源进行简单的滤波即可满足一般使用，可参考AMS1117-3.3数据手册：https://atta.szlcsc.com/upload/public/pdf/source/20180727/C6186_7A095716F0823C02F1997A905E26C086.pdf

![5V转3.3V](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\5V转3.3V.png)

​																						图四

------



#### 主控电路最小系统



图五、六展示了CH32V307VCT6最小系统，芯片为LQFP-100封装，相关引脚定义可在“Hardware\Reference\CH32V307主板资料\[文档]说明书 芯片手册等”目录内的数据手册内找到。其中注意在布局时100nF电容要尽可能接近芯片的每个供电引脚，L1,L2为磁珠，用于减小高频噪声的影响。VDDA接3.3V，VSSA接GND。

![主控电路1](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\主控电路1.png)

​																						图五

为了让芯片工作，还需要准备8M晶振，BOOT按键，复位按键与下载口，程序在下载时主要依赖SWDIO和SWCLK两条线。如果想要芯片连接电脑Debug，则PB10和PB11这一组串口必不可少。BOOT按键主要控制程序启动位置，解决芯片可能会产生自锁等无法烧录程序的情况。

![主控电路2](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\主控电路2.png)

​																						图六

------



图七为常见的蜂鸣器电路，利用三极管放大电流驱动喇叭发生，B9直接连接到单片机引脚，简单的输出0/1即可控制喇叭发生，需要注意选用有源蜂鸣器时只能控制喇叭单一频率声音，若想要产生不同音阶的效果，需要选用无源蜂鸣器。

![蜂鸣器电路](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\蜂鸣器电路.png)

​																						图七

------

图八为常见的按键电路，未闭合时拉高，另一侧接入主控外部中断判断按键按下。



![按键电路](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\按键电路.png)

​																						图八

------

图九为ADC输入分压电路，以其中一路ADC为例讲解电阻选型与设计原因。

由于单片机的ADC引脚耐压范围一般较低，常见最大值为3.3V(+0.3V)，而本次选用的红外测距传感器供电为5V，也意味着其输出的模拟值可能能达到5V，而另外4路ADC输入的最大值达到10V，这就需要对输入的电压范围进行映射，此处由于存在共12路ADC输入，故采用简单的线性分压电路，下面对电路进行分析。

其中，DATA0为外部输入的模拟值，此处范围为0~5V，ADC-SONAR-0为接入单片机的ADC引脚，要求图中交叉红点电压范围为0~3.3V。

根据基尔霍夫电流定理，假设图中交点点电压为$V_{in}$,外部输入电压为$V_{out}$,不难有：
$$
\frac{V_{in}-V_{out}}{R_{32}}+\frac{3.3-V_{out}}{R_{29}}=\frac{V_{out}}{R_{35}}
$$
代入具体的电阻值，可以得到如下线性关系：
$$
V_{out}=0.38\cdot V_{in}+0.78
$$
其中$V_{in}$的范围为0~5V，代入不难发现输入的范围被压缩到了0~3.3V范围之内。

针对0~10V的输入，也提供了图十的电阻选型，其线性关系为：
$$
V_{out}=0.2\cdot V_{in}+0.66
$$
选用如下电阻主要原因为这些电阻为典型阻值，在立创SMT中为基础库(无换料费)。

![ADC分压电路](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\ADC分压电路.png)

​																							图九

![分压电路2](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\分压电路2.png)

​																							图十

------



图十一展示了用于主控芯片与电机驱动芯片间的隔离芯片电路，SN74HC125PWR内部集成四个三态门，引脚默认拉低，100欧姆电阻用于对输入进行限流。基于DRV8701E的驱动电路需要一路PWM信号与一路方向信号，PWM信号控制占空比，方向信号控制是由R_A还是R_B进行输出，从而实现电机的调速与正反转。图十一中PH代表方向，EN代表PWM。SN74HC125PWR芯片低电平使能(引脚旁标有#代表低电平使能)，DRV8701E高电平使能(nSLEEP引脚为使能引脚)，mos管选用TPH1R403NL。

![隔离芯片](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\隔离芯片.png)

​																							图十一

![电机驱动电路](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\电机驱动电路.png)

​																							图十二

------



#### 3D模型图

图十三至十五展示了主控板和电源板的3D模型。

![主板3D图](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\主板3D图.png)

​																							图十三

![电源板3D图(正)](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\电源板3D图(正).png)

​																							图十四

![电源板3D图(反)](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\电源板3D图(反).png)

​																							图十五

------



## 6、Head设计细节

Head部分主要为机械设计，电路部分主要完成接口转接，比较简单。图十六展示了Head搭载的PCB电路。其中R1为滑动变阻器，Head电机旋转时带动滑动变阻器COMMON端移动，从而改变阻值，再由H1接口转接到外部供连接。其头部的光敏电阻其中两个引脚需要焊接到一起，共用H4的COMMON端，其余两个光敏电阻的两个引脚各自连接到H3的NECK_LEFT和RIGHT，再由H4提供连接到外部。H2的motor正负引脚为电机的正负极外部输入引脚，控制电机旋转，H5为激光灯的外部接口，供电电压为5V。

![Head电路设计](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\Head电路设计.png)

​																							图十六

------



图十七展示了Head结构图，共有三个零部件与一块PCB，一个电机构成。

![Head整体结构](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\Head整体结构.png)

​																							图十七

------



图十八展示了第一个零部件光敏电阻与激光灯的安装方法，其中光敏电阻的两个引脚通过零部件的孔传入，激光灯通过滑槽插入固定。第一个零部件主要用于固定这两者。

![光敏电阻与激光灯安装](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\光敏电阻与激光灯安装.png)

​																							图十八

------



图十九展示了第一个零部件和第二个零部件之间的连接，为通过插槽连接，经过测试，插入后不易拔出，较为可靠。第二个零部件与电机相连，由电机带动转动，从而传动下方螺丝刀头旋转，从而带动了滑动变阻器。

![光敏电阻安装器与传动器的固定](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\光敏电阻安装器与传动器的固定.png)

​																							图十九

------



图二十展示了第二个零部件通过螺丝刀头带动滑动变阻器转动。

![Head传动](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\Head传动.png)

​																							图二十

------



图二十一展示了电机与第三个零部件通过螺丝连接，第三个零部件为Head主要支撑体。

![Head电机固定](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\Head电机固定.png)

​																							图二十一



## 7、车模设计

图二十二展示了整体结构，详细设计文件参照‘Hardware\CarModel’下，本设计利用Fusion360完成

![车模3D](C:\Users\86158\Desktop\IEECS-Design\Guide\figure\车模3D.png)

​																							图二十二